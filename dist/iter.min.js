/*! iter 2015-03-04 */
!function(global){"use strict";var isArray=function(value){return value&&Array.isArray(value)},isString=function(value){return"string"==typeof value},isFunction=function(value){return value&&"function"==typeof value},bindContext=function(func,$this){return void 0===$this?func:func.bind($this)},argsToArray=function(args){return Array.prototype.slice.call(args)},ASCII_JS_IDENTIFIER_REGEX=/^[$a-z_][$a-z0-9_]*$/i,isJSIdentifier=function(value){return value&&isString(value)&&ASCII_JS_IDENTIFIER_REGEX.test(value)},quickToFunction=function(expression,options){try{options=options||{};var body,parameters=options.parameters||["$","$index"];return body=options.boolResult?"return Boolean("+expression+");":"return ("+expression+");",Function.apply(null,parameters.concat([body]))}catch(ex){var error=new Error('Attempt to create function from expression "'+expression+'" failed. See $details property for original exception.');throw error.$details=ex,error}},isPropertySelector=function(value){return void 0!==value},createPropertySelectorFunction=function(propertyName){return function($){return $[propertyName]}},isPropertyMultiselector=function(obj){if(!isArray(obj))return!1;for(var i=0;i<obj.length;i+=1)if(!isPropertySelector(obj[i]))return!1;return!0},createPropertyMultiselectorFunciton=function(propertyNames){return function($){for(var result={},i=0;i<propertyNames.length;i+=1)result[propertyNames[i]]=$[propertyNames[i]];return result}},isQuick=function(value){return value&&isString(value)},throwIfNotQuickOrFunction=function(argValue,argName,funcName){if(!argValue||!isString(argValue)&&!isFunction(argValue))throw new Error("Invalid value of iter."+funcName+"() argument "+argName+". Valid values are quick expressions and functions")},ArrayIterator=function($array){this.$$index=-1,this.$$array=$array};ArrayIterator.prototype.next=function(){var incIndex=this.$$index+1;return incIndex<this.$$array.length?(this.$$index=incIndex,!0):!1},ArrayIterator.prototype.current=function(){if(-1===this.$$index)throw new Error("Call next() before current().");return this.$$array[this.$$index]};var ObjectIterator=function($object){this.$$index=-1,this.$$keys=Object.keys($object),this.$$object=$object};ObjectIterator.prototype.next=function(){for(var i=this.$$index+1,keys=this.$$keys,obj=this.$$object;i<keys.length;){if(Object.prototype.hasOwnProperty.call(obj,keys[i])){this.$$index=i;break}i+=1}return i<keys.length},ObjectIterator.prototype.current=function(){if(-1===this.$$index)throw new Error("call next() before current()");var key=this.$$keys[this.$$index],value=this.$$object[key];return{key:key,value:value}};var FunctionIterator=function($func){this.$$func=$func};FunctionIterator.prototype.next=function(){try{var newCurrent=this.$$func();return void 0!==newCurrent?(this.$$current=newCurrent,!0):!1}catch(ex){var error=new Error("Function thrown exception ($details property contains original exception).");throw error.$details=ex,error}},FunctionIterator.prototype.current=function(){if(void 0===this.$$current)throw new Error("Call next() before current().");return this.$$current};var Iterable=function(iteratorFunction){if(!iteratorFunction||"function"!=typeof iteratorFunction)throw new Error("iteratorFunction must be a function.");this.iterator=iteratorFunction};Iterable.prototype.forEach=function(func,$this){var it=this.iterator(),i=0;for(func=bindContext(func,$this);it.next();)func(it.current(),i),i+=1},Iterable.prototype.isEmpty=function(){var it=this.iterator();return it.next()===!1};var SOME_DEFAULT_PRED=function(x){return x};Iterable.prototype.some=function(pred,$this){pred=pred||SOME_DEFAULT_PRED,throwIfNotQuickOrFunction(pred,"pred","some"),isQuick(pred)&&(pred=quickToFunction(pred,{boolResult:!0})),pred=bindContext(pred,$this);for(var it=this.iterator(),index=-1;it.next();)if(index+=1,pred(it.current(),index))return!0;return!1};var EVERY_DEFAULT_PRED=function(x){return x};Iterable.prototype.every=function(pred,$this){pred=pred||EVERY_DEFAULT_PRED,throwIfNotQuickOrFunction(pred,"pred","every"),isQuick(pred)&&(pred=quickToFunction(pred,{boolResult:!0})),pred=bindContext(pred,$this);for(var it=this.iterator(),index=-1;it.next();)if(index+=1,!pred(it.current(),index))return!1;return!0},Iterable.prototype.and=function(){for(var it=this.iterator(),curr=!0;it.next()&&(curr=it.current()););return curr},Iterable.prototype.or=function(){for(var it=this.iterator(),curr=!1;it.next()&&!(curr=it.current()););return curr},Iterable.prototype.count=function(predOpt,$this){var it=null;it=predOpt?this.filter(predOpt,$this).iterator():this.iterator();for(var count=0;it.next();)count+=1;return count},Iterable.prototype.toArray=function(){for(var result=[],it=this.iterator();it.next();)result.push(it.current());return result};var FilterIterator=function($iterator,$pred){this.$$iterator=$iterator,this.$$pred=$pred,this.$$index=-1};FilterIterator.prototype.next=function(){for(;this.$$iterator.next();)if(this.$$index+=1,this.$$pred(this.$$iterator.current(),this.$$index))return!0;return!1},FilterIterator.prototype.current=function(){return this.$$iterator.current()},Iterable.prototype.filter=function(pred,$this){var that=this;return throwIfNotQuickOrFunction(pred,"pred","filter"),"string"==typeof pred&&(pred=quickToFunction(pred,{boolResult:!0})),pred=bindContext(pred,$this),new Iterable(function(){var it=that.iterator();return new FilterIterator(it,pred)})};var MapIterator=function($iterator,$map){this.$$iterator=$iterator,this.$$map=$map,this.$$index=-1,this.$$evaluated=!1};MapIterator.prototype.next=function(){return this.$$iterator.next()?(this.$$cache=void 0,this.$$evaluated=!1,this.$$index+=1,!0):!1},MapIterator.prototype.current=function(){return this.$$evaluated||(this.$$cache=this.$$map(this.$$iterator.current(),this.$$index),this.$$evaluated=!0),this.$$cache},Iterable.prototype.map=function(map,$this){var that=this;return throwIfNotQuickOrFunction(map,"map","map"),isQuick(map)&&(map=quickToFunction(map,{boolResult:!1})),map=bindContext(map,$this),new Iterable(function(){var it=that.iterator();return new MapIterator(it,map)})},Iterable.prototype.select=function(){var args=argsToArray(arguments);if(0===args.length)throw new Error("iter.select: No properties to select passed to select() call.");var mapFunc;if(args.length>1&&isPropertyMultiselector(args))mapFunc=createPropertyMultiselectorFunciton(args);else{if(1!==args.length||!isPropertySelector(args[0]))throw new Error('iter.select: Invalid argument, select() only accept property name(s). To select single property use select("propertyName") syntax, to select multiple properties use select("prop1", "prop2", "prop3").');mapFunc=createPropertySelectorFunction(args[0])}return this.map(mapFunc)},Iterable.prototype.foldl=function(seed,operation,$this){throwIfNotQuickOrFunction(operation,"operation","foldl"),isQuick(operation)&&(operation=quickToFunction(operation,{boolResult:!1,parameters:"$acc, $"})),operation=bindContext(operation,$this);for(var acc=seed,it=this.iterator();it.next();)acc=operation(acc,it.current());return acc},Iterable.prototype.foldl1=function(operation,$this){throwIfNotQuickOrFunction(operation,"operation","foldl1"),isQuick(operation)&&(operation=quickToFunction(operation,{boolResult:!1,parameters:"$acc, $"})),operation=bindContext(operation,$this);var it=this.iterator();if(!it.next())throw new Error("iter.foldl1: sequence contains no elements.");for(var acc=it.current();it.next();)acc=operation(acc,it.current());return acc};var OP_PLUS=function(acc,x){return acc+Number(x)};Iterable.prototype.sum=function(seed){return seed=Number(seed)||0,this.foldl(seed,OP_PLUS)};var OP_MUL=function(acc,x){return acc*Number(x)};Iterable.prototype.product=function(seed){return seed=Number(seed)||1,this.foldl(seed,OP_MUL)},Iterable.prototype.avg=function(){for(var it=this.iterator(),n=0,sum=0;it.next();)n+=1,sum+=Number(it.current());return 0===n?0/0:sum/n};var SkipIterator=function($iterator,$skip){this.$$iterator=$iterator,this.$$skip=$skip};SkipIterator.prototype.next=function(){for(;this.$$iterator.next();){if(0===this.$$skip)return!0;this.$$skip-=1}return!1},SkipIterator.prototype.current=function(){return this.$$iterator.current()},Iterable.prototype.skip=function(count){count=Number(count);var that=this;if(!isFinite(count))throw new Error("iter.skip: invalid argument value.");return count=0>count?0:count,new Iterable(function(){var it=that.iterator();return new SkipIterator(it,count)})};var TakeIterator=function($iterator,$take){this.$$iterator=$iterator,this.$$take=$take};TakeIterator.prototype.next=function(){return 0===this.$$take?!1:this.$$iterator.next()?(this.$$take-=1,!0):!1},TakeIterator.prototype.current=function(){return this.$$iterator.current()},Iterable.prototype.take=function(count){count=Number(count);var that=this;if(!isFinite(count))throw new Error("iter.take: invalid argument value.");return count=0>count?0:count,new Iterable(function(){var it=that.iterator();return new TakeIterator(it,count)})},Iterable.prototype.join=function(separator){var array=this.toArray();return array.join(separator)};var SORT_BY_COMPARER_CONSTRUCTOR=function(){var comparers=argsToArray(arguments);return function(left,right){for(var i=0;i<comparers.length;i++){var cmp=comparers[i](left,right);if(0!==cmp)return cmp}return 0}},SORT_BY_QUICK_REGEX=/^\$[a-z_][a-z0-9_]*\.[a-z_][a-z0-9_]*/i,isSortByQuick=function(str){return SORT_BY_QUICK_REGEX.test(str)},createComparerFromQuick=function(quick){var dot=quick.indexOf("."),comparer=quick.substr(0,dot),propertyName=quick.substr(dot+1),comparerFunction=Iterable.prototype.sortBy.comparers[comparer];if(!comparerFunction)throw new Error('iter.sortBy: cannot find comparer: "'+comparer+'"');var propertySelector=createPropertySelectorFunction(propertyName);return function(l,r){return l=propertySelector(l),r=propertySelector(r),comparerFunction(l,r)}};Iterable.prototype.sortBy=function(){var sortCriteria=argsToArray(arguments);if(0===sortCriteria.length)throw new Error("iter.sortBy: specify at least one sorting criteria");for(var i=0;i<sortCriteria.length;i+=1){if(throwIfNotQuickOrFunction(sortCriteria[i],"sort criteria","sortBy"),"string"==typeof sortCriteria[i]&&!isSortByQuick(sortCriteria[i]))throw new Error('iter.sortBy: invalid sort criteria: "'+sortCriteria[i]+'". Quick sort criteria have $desc.propName or $asc.propName format.');sortCriteria[i]=createComparerFromQuick(sortCriteria[i])}var cmp=SORT_BY_COMPARER_CONSTRUCTOR.apply(null,sortCriteria),that=this;return new Iterable(function(){var data=that.toArray();return Array.sort(data,cmp),ArrayIterator(data)})},Iterable.prototype.sortBy.comparers={asc:function(l,r){return r>l?-1:l>r?1:0},desc:function(l,r){return r>l?1:l>r?-1:0},localeAsc:function(l,r){return(l||"").localeCompare(r)},localeDesc:function(l,r){return-(l||"").localeCompare(r)}};var iter=global.iter=function(obj){if(Array.isArray(obj))return new Iterable(function(){return new ArrayIterator(obj)});if(obj&&"object"==typeof obj)return new Iterable(function(){return new ObjectIterator(obj)});if(obj&&"function"==typeof obj)return new Iterable(function(){return new FunctionIterator(obj)});throw new Error("Only arrays, object and functions can be iterated.")};iter.Iterable=Iterable,iter.range=function(){var argsLenght=arguments.length,args=Array.prototype.slice.call(arguments);if(2!==argsLenght&&3!==argsLenght)throw new Error("iter.range: Invalid range arguments. Use range(from, to) or range(from, step, to).");var hasStep=3===argsLenght,from=Number(args[0]),to=Number(hasStep?args[2]:args[1]);if(!isFinite(from))throw new Error("iter.range: from must be a finite number.");if(!isFinite(to))throw new Error("iter.range: to must be a finite number.");var step;if(to>=from){if(step=hasStep?args[1]:1,0>=step)throw new Error("iter.range: step must be a positive number.")}else if(step=hasStep?args[1]:-1,step>=0)throw new Error("iter.range: step must be a negative number.");if(!isFinite(step))throw new Error("iter.range: step must be finite number.");var index=0;return iter(step>=0?function(){var next=from+index*step;return next>=to?void 0:(index+=1,next)}:function(){var next=from+index*step;return to>=next?void 0:(index+=1,next)})};var EMPTY_ITERATOR_FUNCTION=function(){return void 0};iter.empty=function(){return iter(EMPTY_ITERATOR_FUNCTION)},iter.quick=function(parameters,expression,options){var args=argsToArray(arguments);if(1===args.length&&(parameters=["$"],expression=args[0],options={}),!isArray(parameters))throw new Error('iter.quick: parameters should be passed as array of identifiers e.g. iter.quick(["$"], "$ > 3")');for(var i=0;i<parameters.length;i+=1)if(!isJSIdentifier(parameters[i]))throw new Error('iter.quick: invalid JavaScript parameter name: "'+parameters[i]+'"');if(!isQuick(expression))throw new Error("iter.quick: invalid or missing expression argument");return options=options||{},quickToFunction(expression,{parameters:parameters})}}("undefined"==typeof window?global:window);